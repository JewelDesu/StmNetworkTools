Transfer sc-router from host pc to stm board

scp -r Downloads/sc-router_1.1.0/sc-router_arm root@192.168.0.102:/home/root


Install required tools and libraries

apt-get install  ccid
apt-get install pcsc-tools


Change the permissions

chmod +x sc-router_arm



Run the router

./sc-router_arm setup
./sc-router_arm run






Log


root@stm32mp1:~# apt-get install  ccid
_________________________________________
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
The following additional packages will be installed:
  pcsc-lite
The following NEW packages will be installed:
  ccid pcsc-lite
0 upgraded, 2 newly installed, 0 to remove and 0 not upgraded.
Need to get 89.4 kB of archives.
After this operation, 0 B of additional disk space will be used.
Do you want to continue? [Y/n] y
Get:1 http://packages.openstlinux.st.com/5.0 mickledore/untested armhf pcsc-lite armhf 1.9.9-r0 [37.9 kB]
Get:2 http://packages.openstlinux.st.com/5.0 mickledore/untested armhf ccid armhf 1.5.2-r0 [51.5 kB]
Fetched 89.4 kB in 10s (8520 B/s)

The software package is provided AS IS, and by downloading it, you agree to be bound to the terms of the software
license agreement (SLA).
The detailed content licenses can be found at https://wiki.st.com/stm32mpu/wiki/OpenSTLinux_licenses.

Selecting previously unselected package pcsc-lite.
(Reading database ... 15949 files and directories currently installed.)
Preparing to unpack .../pcsc-lite_1.9.9-r0_armhf.deb ...
Unpacking pcsc-lite (1.9.9-r0) ...
Selecting previously unselected package ccid.
Preparing to unpack .../ccid_1.5.2-r0_armhf.deb ...
Unpacking ccid (1.5.2-r0) ...
Setting up pcsc-lite (1.9.9-r0) ...
Created symlink /etc/systemd/system/sockets.target.wants/pcscd.socket -> /lib/systemd/system/pcscd.socket.
Setting up ccid (1.5.2-r0) ...

root@stm32mp1:~# apt-get install pcsc-tools
_________________________________________________________
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
The following additional packages will be installed:
  libpcsc-perl libpcsclite1 perl-module-carp perl-module-class-struct perl-module-constant perl-module-dynaloader
  perl-module-exporter perl-module-exporter-heavy perl-module-fcntl perl-module-file-stat perl-module-getopt-std
  perl-module-mro perl-module-overload perl-module-overload-numbers perl-module-overloading perl-module-xsloader
The following NEW packages will be installed:
  libpcsc-perl libpcsclite1 pcsc-tools perl-module-carp perl-module-class-struct perl-module-constant
  perl-module-dynaloader perl-module-exporter perl-module-exporter-heavy perl-module-fcntl perl-module-file-stat
  perl-module-getopt-std perl-module-mro perl-module-overload perl-module-overload-numbers perl-module-overloading
  perl-module-xsloader
0 upgraded, 17 newly installed, 0 to remove and 0 not upgraded.
Need to get 267 kB of archives.
After this operation, 0 B of additional disk space will be used.
Do you want to continue? [Y/n] y
Get:1 http://packages.openstlinux.st.com/5.0 mickledore/main armhf perl-module-carp armhf 5.36.0-r0 [12.9 kB]
Get:2 http://packages.openstlinux.st.com/5.0 mickledore/untested armhf libpcsc-perl armhf 1.4.14-r0 [20.0 kB]
Get:3 http://packages.openstlinux.st.com/5.0 mickledore/untested armhf libpcsclite1 armhf 1.9.9-r0 [14.2 kB]
Get:4 http://packages.openstlinux.st.com/5.0 mickledore/main armhf perl-module-exporter-heavy armhf 5.36.0-r0 [3408 B]
Get:5 http://packages.openstlinux.st.com/5.0 mickledore/main armhf perl-module-exporter armhf 5.36.0-r0 [8032 B]
Get:6 http://packages.openstlinux.st.com/5.0 mickledore/main armhf perl-module-class-struct armhf 5.36.0-r0 [6972 B]
Get:7 http://packages.openstlinux.st.com/5.0 mickledore/main armhf perl-module-constant armhf 5.36.0-r0 [6628 B]
Get:8 http://packages.openstlinux.st.com/5.0 mickledore/main armhf perl-module-dynaloader armhf 5.36.0-r0 [10.1 kB]
Get:9 http://packages.openstlinux.st.com/5.0 mickledore/main armhf perl-module-xsloader armhf 5.36.0-r0 [5440 B]
Get:10 http://packages.openstlinux.st.com/5.0 mickledore/main armhf perl-module-fcntl armhf 5.36.0-r0 [6560 B]
Get:11 http://packages.openstlinux.st.com/5.0 mickledore/main armhf perl-module-mro armhf 5.36.0-r0 [10.3 kB]
Get:12 http://packages.openstlinux.st.com/5.0 mickledore/main armhf perl-module-overload-numbers armhf 5.36.0-r0 [1632 B]
Get:13 http://packages.openstlinux.st.com/5.0 mickledore/main armhf perl-module-overloading armhf 5.36.0-r0 [1592 B]
Get:14 http://packages.openstlinux.st.com/5.0 mickledore/main armhf perl-module-overload armhf 5.36.0-r0 [18.0 kB]
Get:15 http://packages.openstlinux.st.com/5.0 mickledore/main armhf perl-module-file-stat armhf 5.36.0-r0 [4904 B]
Get:16 http://packages.openstlinux.st.com/5.0 mickledore/main armhf perl-module-getopt-std armhf 5.36.0-r0 [3936 B]
Get:17 http://packages.openstlinux.st.com/5.0 mickledore/untested armhf pcsc-tools armhf 1.6.2-r0 [132 kB]
Fetched 267 kB in 11s (24.1 kB/s)

The software package is provided AS IS, and by downloading it, you agree to be bound to the terms of the software
license agreement (SLA).
The detailed content licenses can be found at https://wiki.st.com/stm32mpu/wiki/OpenSTLinux_licenses.

Selecting previously unselected package perl-module-carp.
(Reading database ... 15960 files and directories currently installed.)
Preparing to unpack .../00-perl-module-carp_5.36.0-r0_armhf.deb ...
Unpacking perl-module-carp (5.36.0-r0) ...
Selecting previously unselected package libpcsc-perl.
Preparing to unpack .../01-libpcsc-perl_1.4.14-r0_armhf.deb ...
Unpacking libpcsc-perl (1.4.14-r0) ...
Selecting previously unselected package libpcsclite1.
Preparing to unpack .../02-libpcsclite1_1.9.9-r0_armhf.deb ...
Unpacking libpcsclite1 (1.9.9-r0) ...
Selecting previously unselected package perl-module-exporter-heavy.
Preparing to unpack .../03-perl-module-exporter-heavy_5.36.0-r0_armhf.deb ...
Unpacking perl-module-exporter-heavy (5.36.0-r0) ...
Selecting previously unselected package perl-module-exporter.
Preparing to unpack .../04-perl-module-exporter_5.36.0-r0_armhf.deb ...
Unpacking perl-module-exporter (5.36.0-r0) ...
Selecting previously unselected package perl-module-class-struct.
Preparing to unpack .../05-perl-module-class-struct_5.36.0-r0_armhf.deb ...
Unpacking perl-module-class-struct (5.36.0-r0) ...
Selecting previously unselected package perl-module-constant.
Preparing to unpack .../06-perl-module-constant_5.36.0-r0_armhf.deb ...
Unpacking perl-module-constant (5.36.0-r0) ...
Selecting previously unselected package perl-module-dynaloader.
Preparing to unpack .../07-perl-module-dynaloader_5.36.0-r0_armhf.deb ...
Unpacking perl-module-dynaloader (5.36.0-r0) ...
Selecting previously unselected package perl-module-xsloader.
Preparing to unpack .../08-perl-module-xsloader_5.36.0-r0_armhf.deb ...
Unpacking perl-module-xsloader (5.36.0-r0) ...
Selecting previously unselected package perl-module-fcntl.
Preparing to unpack .../09-perl-module-fcntl_5.36.0-r0_armhf.deb ...
Unpacking perl-module-fcntl (5.36.0-r0) ...
Selecting previously unselected package perl-module-mro.
Preparing to unpack .../10-perl-module-mro_5.36.0-r0_armhf.deb ...
Unpacking perl-module-mro (5.36.0-r0) ...
Selecting previously unselected package perl-module-overload-numbers.
Preparing to unpack .../11-perl-module-overload-numbers_5.36.0-r0_armhf.deb ...
Unpacking perl-module-overload-numbers (5.36.0-r0) ...
Selecting previously unselected package perl-module-overloading.
Preparing to unpack .../12-perl-module-overloading_5.36.0-r0_armhf.deb ...
Unpacking perl-module-overloading (5.36.0-r0) ...
Selecting previously unselected package perl-module-overload.
Preparing to unpack .../13-perl-module-overload_5.36.0-r0_armhf.deb ...
Unpacking perl-module-overload (5.36.0-r0) ...
Selecting previously unselected package perl-module-file-stat.
Preparing to unpack .../14-perl-module-file-stat_5.36.0-r0_armhf.deb ...
Unpacking perl-module-file-stat (5.36.0-r0) ...
Selecting previously unselected package perl-module-getopt-std.
Preparing to unpack .../15-perl-module-getopt-std_5.36.0-r0_armhf.deb ...
Unpacking perl-module-getopt-std (5.36.0-r0) ...
Selecting previously unselected package pcsc-tools.
Preparing to unpack .../16-pcsc-tools_1.6.2-r0_armhf.deb ...
Unpacking pcsc-tools (1.6.2-r0) ...
Setting up perl-module-constant (5.36.0-r0) ...
Setting up perl-module-overload-numbers (5.36.0-r0) ...
Setting up libpcsclite1 (1.9.9-r0) ...
Setting up perl-module-overloading (5.36.0-r0) ...
Setting up perl-module-carp (5.36.0-r0) ...
Setting up perl-module-exporter-heavy (5.36.0-r0) ...
Setting up perl-module-dynaloader (5.36.0-r0) ...
Setting up libpcsc-perl (1.4.14-r0) ...
Setting up perl-module-exporter (5.36.0-r0) ...
Setting up perl-module-class-struct (5.36.0-r0) ...
Setting up perl-module-xsloader (5.36.0-r0) ...
Setting up perl-module-getopt-std (5.36.0-r0) ...
Setting up perl-module-mro (5.36.0-r0) ...
Setting up perl-module-fcntl (5.36.0-r0) ...
Setting up perl-module-overload (5.36.0-r0) ...
Setting up perl-module-file-stat (5.36.0-r0) ...
Setting up pcsc-tools (1.6.2-r0) ...

root@stm32mp1:~# chmod +x sc-router_arm
________________________________________________
root@stm32mp1:~# ./sc-router_arm
Application for routing TCO requests to the appropriate Smart Card

Usage:
  sc-router [flags]
  sc-router [command]

Available Commands:
  completion  Generate the autocompletion script for the specified shell
  help        Help about any command
  run         Run the smart card router.
  setup       Register a new smart cards
  version     Print the version of the application

Flags:
      --company-cards string   Output file for the company cards (default "company-cards.yaml")
  -h, --help                   help for sc-router

Use "sc-router [command] --help" for more information about a command.
root@stm32mp1:~# ./sc-router_arm setup
2025/02/06 13:42:15 Loaded 0 existing cards.

2025/02/06 13:42:15 Failed to list readers: scard: Cannot find a smart card reader.
root@stm32mp1:~# ./sc-router_arm setup
2025/02/06 13:43:47 Loaded 0 existing cards.

2025/02/06 13:43:47 Card detected, number: 00021CBA011714AD9000
Enter usercode (or type 'exit' to quit):
> 009ce2d26cdc0950602019e861645c0b
Enter friendly name for card (or pres enter to skip):
> simb
2025/02/06 13:44:47 Card 00021CBA011714AD9000 registered
Insert a new card and press enter to continue. Type 'exit' to quit:
> exit
Smart card registered successfully!
root@stm32mp1:~# ./sc-router_arm run
2025/02/06 13:44:54 Loaded 1 existing cards.

2025/02/06 13:44:54 [mux] Starting multiplexer
2025/02/06 13:44:59 [mux] Authenticated card simb
2025/02/06 13:44:59 [mux][simb] Heartbeat response
2025/02/06 13:45:09 [mux][simb] Heartbeat response
2025/02/06 13:45:19 [mux][simb] Heartbeat response
2025/02/06 13:45:29 [mux][simb] Heartbeat response